trigger:
  paths:
    include:
      - samreglib/testData/*/*.xml

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: |
    pip install xmltodict
  displayName: 'Install dependencies'

- script: |
    changed_xml_files=$(git diff --name-only HEAD HEAD~1 | grep 'samreglib/testData/.*/.*\.xml$')
    if [ -n "$changed_xml_files" ]; then
      for file in $changed_xml_files; do
        python samreglib/utils/processXML/process_xml.py "$file"
        json_file="${file%.xml}.json"
        git rm "$file"
        git add "$json_file"
      done
      git config --global user.email "pipeline@azure.com"
      git config --global user.name "Azure Pipeline"
      git commit -m "Processed XML files to JSON"
      git push https://$(System.AccessToken)@dev.azure.com/yourorg/yourproject/_git/yourrepo
    else
      echo "No XML files changed."
    fi
  displayName: 'Process XML files and commit JSON'
