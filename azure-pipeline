\trigger:
  paths:
    include:
      - testData/**

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: |
    # Install necessary Python packages (if needed)
    pip install -r requirements.txt
  displayName: 'Install dependencies'

- script: |
    # Get list of all added files
    added_files=$(git diff --name-only --diff-filter=A HEAD^ HEAD)
    for file in $added_files; do
      # Check if the file is an XML in MinerLib/testData/<something>/
      if [[ $file == MinerLib/testData/*/*.xml ]]; then
        echo "Processing $file"
        python utils/processXML/process_xml.py "$file"
      fi
    done
  displayName: 'Process added XML files'

- script: |
    # Check if there are any changes to commit
    if [ -n "$(git status --porcelain)" ]; then
      git config --global user.email "pipeline@example.com"
      git config --global user.name "Pipeline"
      git add .
      git commit -m "Converted XML to JSON for testData"
      git push origin HEAD:$(git rev-parse --abbrev-ref HEAD)
    fi
  displayName: 'Commit and push JSON files'
