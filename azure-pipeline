trigger:
  paths:
    include:
      - samreglib/testData/*/*.xml

pool:
  name: 'Self-hosted'

steps:
- checkout: self
  fetchDepth: 1  # Only the latest commit is fetched

# Windows: Use PowerShell
- task: PowerShell@2
  condition: eq(variables['Agent.OS'], 'Windows_NT')
  inputs:
    targetType: 'inline'
    script: |
      $changedXmlFiles = git show --name-only --pretty=format: HEAD | Where-Object { $_ -match 'samreglib/testData/[^/]+/[^/]+\.xml$' }
      if ($changedXmlFiles) {
          Write-Host "XML files changed in the latest commit:"
          $changedXmlFiles | ForEach-Object { Write-Host $_ }
          # Add your processing logic here, e.g.,:
          # foreach ($file in $changedXmlFiles) {
          #     python samreglib/utils/processXML/process_xml.py $file
          # }
      } else {
          Write-Host "No XML files changed in the latest commit."
      }
  displayName: 'Check Latest XML Files (Windows)'

# Linux: Use Bash
- task: Bash@3
  condition: eq(variables['Agent.OS'], 'Linux')
  inputs:
    targetType: 'inline'
    script: |
      changed_xml_files=$(git show --name-only --pretty=format: HEAD | grep -E 'samreglib/testData/[^/]+/[^/]+\.xml$')
      if [ -n "$changed_xml_files" ]; then
        echo "XML files changed in the latest commit:"
        echo "$changed_xml_files"
        # Add your processing logic here, e.g.,:
        # for file in $changed_xml_files; do
        #   python samreglib/utils/processXML/process_xml.py "$file"
        # done
      else
        echo "No XML files changed in the latest commit."
      fi
  displayName: 'Check Latest XML Files (Linux)'
