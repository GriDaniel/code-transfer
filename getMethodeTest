trigger:
  branches:
    include:
      - main
  paths:
    include:
      - samreglib/Samuel/Samuel/plugins/**/*.py

pool:
  name: 'Self-hosted'

jobs:
  - job: DetectChanges
    steps:
      - task: UsePythonVersion@0
        inputs:
          versionSpec: '3.x'
          addToPath: true
      - powershell: |
          # Get files changed in the latest commit
          $changedFiles = git diff --name-only HEAD HEAD~1
          # Filter to .py files in samreglib/Samuel/Samuel/plugins/
          $filteredFiles = $changedFiles | Where-Object { $_ -match '^samreglib/Samuel/Samuel/plugins/.*\.py$' }
          # Loop through each changed .py file
          foreach ($file in $filteredFiles) {
              if ($file) {
                  # Extract the folder name after plugins/
                  $folder = ($file -replace 'samreglib/Samuel/Samuel/plugins/([^/]+)/.*', '$1')
                  # Run the Python script with the folder name
                  python samreglib/utils/regressionTest/getMethodeTest.py $folder
              }
          }
        displayName: 'Run script for each changed .py file'
